var ajaxurl=meta_image.ajaxurl,user={onReady:function(){user.imageUploader(),user.backgroundUploader(),user.removeImage(),user.removeBackgroundImage(),user.imageDrop()},imageUploader:function(){var e;jQuery(".upload-image").click(function(a){a.preventDefault();var t=jQuery(this),r=jQuery(this).parent(),u=r.attr("data-img"),n=r.attr("data-input"),o=r.attr("data-user"),i=jQuery("#"+n),d=jQuery("."+u);e=wp.media.frames.meta_image_frame=wp.media({title:meta_image.title,button:{text:meta_image.button},library:{type:"image"},multiple:!0}),e.on("select",function(){var a=e.state().get("selection").first().toJSON();d.find("img").remove(),d.append('<img src="'+a.url+'" alt="" />'),i.val(a.url),r.append('<button class="remove-image button button-large heard-btn">Remove</button>'),t.remove(),user.saveImage(n,o,a.url)}),e.open()})},removeImage:function(){jQuery(".remove-image").click(function(e){e.preventDefault();var a=jQuery(this).parent().attr("data-input"),t=jQuery(this).parent().attr("data-user");jQuery(this).parent().find("input").val(""),jQuery(this).parent().find("img").remove(),user.saveImage(a,t,""),jQuery(this).parent().append('<button class="add button button-large upload-image" id="upload-logo" style="text-align:center;" data-input="agent_image" data-img="profile" data-user="<?php echo $user_id; ?>">Upload/Set Profile Image</button>'),jQuery(this).remove(),user.imageUploader()})},saveImage:function(e,a,t){jQuery.ajax({url:ajaxurl,type:"GET",data:{imageField:e,fieldVal:t,userID:a,action:"setImage"},dataType:"html",success:function(){user.removeImage()},error:function(e,a,t){window.alert(e+" :: "+a+" :: "+t)}})},backgroundUploader:function(){var e;jQuery(".upload-background").click(function(a){a.preventDefault();var t=jQuery(this),r=jQuery(this).parent(),u=r.attr("data-input"),n=jQuery("#"+u),o=jQuery(".background");e=wp.media.frames.meta_image_frame=wp.media({title:meta_image.title,button:{text:meta_image.button},library:{type:"image, video"},multiple:!1}),e.on("select",function(){var a=e.state().get("selection").first().toJSON();"video"===a.type&&jQuery(".background").append('<video muted autoplay id="bgvid" loop><source src="'+a.url+'" type="video/webm"><source src="'+a.url+'" type="video/ogv"><source src="'+a.url+'" type="video/mp4"></video>'),"image"===a.type&&jQuery(".background").append('<img src="'+a.url+'" alt="" />'),jQuery("#bgUpload").find("input").val(a.url),r.append('<button class="remove-background button button-large">Remove</button>'),t.remove(),user.saveBackgroundImage(a.url),user.removeBackgroundImage()}),e.open()})},saveBackgroundImage:function(e){jQuery.ajax({url:ajaxurl,type:"GET",data:{fieldVal:e,action:"setBackgroundImage"},dataType:"html",error:function(e,a,t){window.alert(e+" :: "+a+" :: "+t)}})},removeBackgroundImage:function(){jQuery(".remove-background").click(function(e){e.preventDefault();var a=jQuery(this).parent().attr("data-input");jQuery(this).parent().find("input").val(""),jQuery(".background").html(""),user.saveBackgroundImage(""),jQuery(this).parent().append('<button class="add button button-large upload-background" style="text-align:center;" data-input="custom_bg" data-img="bg">Upload/Set Background</button>'),jQuery(this).remove(),user.backgroundUploader()})},dropImage:function(e,a,t,r){jQuery.ajax({url:ajaxurl,type:"GET",data:{imageField:e,imageVal:t,userID:a,action:"dropImage"},processData:!1,contentType:!1,success:function(e,a){jQuery("#"+e).css("background","url("+a+") no-repeat scroll center / cover")},error:function(e,a,t){window.alert(e+" :: "+a+" :: "+t)}})},imageDrop:function(){jQuery("input[type=file]").change(function(e){var a=jQuery(this).attr("name"),t=jQuery(this).attr("data-user"),r=jQuery(this).attr("data-target");user.dropImage(a,t,image,r)})}};jQuery(document).ready(function(){user.onReady()});